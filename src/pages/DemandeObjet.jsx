import React, {useState, useEffect} from 'react'
import { supabase } from '../supabaseClient.js'
export default function DemandeObjet(){const [user,setUser]=useState(null);const [demandes,setDemandes]=useState([]);const [form,setForm]=useState({objet:'',quantite:1});React.useEffect(()=>{supabase.auth.getUser().then(({data})=>{ if(data?.user) setUser(data.user) });fetchDemandes()},[]);async function fetchDemandes(){const {data,error}=await supabase.from('demandes').select('*').order('created_at',{ascending:false});if(!error)setDemandes(data)}async function handleSubmit(e){e.preventDefault();if(!form.objet) return;const {error}=await supabase.from('demandes').insert([{joueur: user?.email||'Anonyme', objet: form.objet, quantite: Number(form.quantite)||1}]);if(!error){setForm({objet:'',quantite:1});fetchDemandes()}else alert(error.message)}async function handleDelete(id){const {error}=await supabase.from('demandes').delete().eq('id',id);if(!error)fetchDemandes();else alert(error.message)}return(<div className='max-w-6xl mx-auto grid grid-cols-12 gap-6'><div className='col-span-4'><div className='form-box bg-card p-4 rounded-md border border-gray-700'><h3 className='font-semibold mb-2'>Nouvelle demande</h3><form onSubmit={handleSubmit} className='flex flex-col gap-3'><input value={form.objet} onChange={e=>setForm({...form, objet:e.target.value})} placeholder="Nom de l'objet" className='p-2 rounded bg-gray-900 border border-gray-800'/><input type='number' value={form.quantite} onChange={e=>setForm({...form, quantite:e.target.value})} className='p-2 rounded bg-gray-900 border border-gray-800' min='1'/><button className='mt-2 py-2 bg-neon text-black rounded font-semibold'>Ajouter</button></form></div></div><div className='col-span-8'><div className='big-table bg-card p-4 rounded-md border border-gray-700'><h3 className='text-lg font-semibold mb-3'>Tableau des demandes</h3><table className='w-full text-left'><thead className='text-sm text-blue-200/80'><tr><th className='pb-2'>Joueur</th><th className='pb-2'>Objet</th><th className='pb-2'>Quantit√©</th><th className='pb-2'>Actions</th></tr></thead><tbody>{demandes.length===0 ? <tr><td colSpan='4' className='py-6 text-center text-gray-400'>Aucune demande.</td></tr> : demandes.map(d=>(<tr key={d.id} className='hover:bg-blue-950/10 transition'><td className='py-2'>{d.joueur}</td><td className='py-2'>{d.objet}</td><td className='py-2'>{d.quantite}</td><td className='py-2'><button onClick={()=>handleDelete(d.id)} className='text-red-400'>Suppr</button></td></tr>))}</tbody></table></div></div></div>)}
