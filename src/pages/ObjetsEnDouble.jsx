import React, {useState, useEffect} from 'react'
import { supabase } from '../supabaseClient.js'
export default function ObjetsEnDouble(){const [user,setUser]=useState(null);const [objets,setObjets]=useState([]);const [form,setForm]=useState({nom:'',quantite:1});React.useEffect(()=>{supabase.auth.getUser().then(({data})=>{ if(data?.user) setUser(data.user) });fetchObjets()},[]);async function fetchObjets(){const {data,error}=await supabase.from('objets_en_double').select('*').order('created_at',{ascending:false});if(!error)setObjets(data)}async function handleSubmit(e){e.preventDefault();if(!form.nom) return;const {error}=await supabase.from('objets_en_double').insert([{joueur: user?.email||'Anonyme', nom: form.nom, quantite: Number(form.quantite)||1}]);if(!error){setForm({nom:'',quantite:1});fetchObjets()}else alert(error.message)}async function handleDelete(id){const {error}=await supabase.from('objets_en_double').delete().eq('id',id);if(!error)fetchObjets();else alert(error.message)}return(<div className='max-w-6xl mx-auto grid grid-cols-12 gap-6'><div className='col-span-4'><div className='form-box bg-card p-4 rounded-md border border-gray-700'><h3 className='font-semibold mb-2'>Ajouter un objet en double</h3><form onSubmit={handleSubmit} className='flex flex-col gap-3'><input value={form.nom} onChange={e=>setForm({...form, nom:e.target.value})} placeholder="Nom de l'objet" className='p-2 rounded bg-gray-900 border border-gray-800'/><input type='number' value={form.quantite} onChange={e=>setForm({...form, quantite:e.target.value})} className='p-2 rounded bg-gray-900 border border-gray-800' min='1'/><button className='mt-2 py-2 bg-neon text-black rounded font-semibold'>Ajouter</button></form></div></div><div className='col-span-8'><div className='big-table bg-card p-4 rounded-md border border-gray-700'><h3 className='text-lg font-semibold mb-3'>Objets en double</h3><table className='w-full text-left'><thead className='text-sm text-blue-200/80'><tr><th className='pb-2'>Joueur</th><th className='pb-2'>Objet</th><th className='pb-2'>Quantit√©</th><th className='pb-2'>Actions</th></tr></thead><tbody>{objets.length===0 ? <tr><td colSpan='4' className='py-6 text-center text-gray-400'>Aucun objet.</td></tr> : objets.map(o=>(<tr key={o.id} className='hover:bg-blue-950/10 transition'><td className='py-2'>{o.joueur}</td><td className='py-2'>{o.nom}</td><td className='py-2'>{o.quantite}</td><td className='py-2'><button onClick={()=>handleDelete(o.id)} className='text-red-400'>Suppr</button></td></tr>))}</tbody></table></div></div></div>)}
